#ddev-generated
# Detect exploit paths typically used to probe for vulnerabilities
sub detect_exploit_paths {
    # WordPress paths (not relevant for Drupal but commonly probed)
    if (req.url ~ "(?i)(/wp-admin|/wp-login\.php|/wp-content/|/wp-includes/)") {
        set req.http.is-exploit-path = "true";
    }

    # Joomla paths
    if (req.url ~ "(?i)(/index\.php\?option=com_|/components/com_)") {
        set req.http.is-exploit-path = "true";
    }

    # Database admin tools
    if (req.url ~ "(?i)(/phpmyadmin|/myadmin|/mysql|/pma|/adminer|/mysqladmin)") {
        set req.http.is-exploit-path = "true";
    }

    # Information disclosure and config files
    if (req.url ~ "(?i)(\.env|\.git|\.svn|\.htaccess|\.htpasswd|\.config|config\.php|settings\.php)") {
        # Exclude Drupal's legitimate settings.php access if needed
        if (req.url !~ "(?i)^/core/rebuild\.php") {
            set req.http.is-exploit-path = "true";
        }
    }

    # Common exploits paths
    if (req.url ~ "(?i)(/cgi-bin/|/xmlrpc\.php|/wlwmanifest\.xml|/HNAP1/)") {
        set req.http.is-exploit-path = "true";
    }

    # File uploads and includes
    if (req.url ~ "(?i)(file_upload|file_manager|elfinder|upload\.php|uploadify|filemanager)") {
        set req.http.is-exploit-path = "true";
    }
}
